name: ğŸ¬ Video Pipeline â€“ 3x TÃ¤glich

on:
  schedule:
    # TÃ¤glich um 06:00 Uhr (UTC = 07:00 Uhr DE-Zeit im Winter, 08:00 im Sommer)
    - cron: '0 5 * * *'
  workflow_dispatch:
    # Erlaubt manuellen Start per Knopfdruck auf GitHub

jobs:
  create-videos:
    runs-on: ubuntu-latest
    timeout-minutes: 90

    steps:

      # â”€â”€ 1. Repository auschecken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¥ Repository laden
        uses: actions/checkout@v4

      # â”€â”€ 2. Python + System-Tools installieren â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ Python einrichten
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ› ï¸ System-Pakete installieren
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y ffmpeg fonts-dejavu -qq

      - name: ğŸ“¦ Python-Pakete installieren
        run: |
          pip install \
            edge-tts \
            google-auth \
            google-auth-oauthlib \
            google-auth-httplib2 \
            google-api-python-client \
            requests

      # â”€â”€ 3. Alle 3 Videos erstellen und hochladen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ¬ Videos erstellen und hochladen
        env:
          GEMINI_API_KEY:   ${{ secrets.GEMINI_API_KEY }}
          PEXELS_API_KEY:   ${{ secrets.PEXELS_API_KEY }}
          YOUTUBE_TOKEN:    ${{ secrets.YOUTUBE_TOKEN }}
          YOUTUBE_CLIENT:   ${{ secrets.YOUTUBE_CLIENT }}
        run: |
          python pipeline/run_pipeline.py

      # â”€â”€ 4. Log speichern (optional, fÃ¼r Fehlersuche) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“Š Pipeline-Log speichern
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: pipeline-log-${{ github.run_id }}
          path: pipeline/log_*.txt
          retention-days: 7
